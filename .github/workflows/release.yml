name: Build and Release

on:
  push:
    branches:
      - main
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Get version
        id: version
        run: |
          if [[ $GITHUB_REF == refs/tags/* ]]; then
            VERSION=${GITHUB_REF#refs/tags/}
          else
            VERSION="dev-$(date +%Y%m%d-%H%M%S)"
          fi
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "Building version: $VERSION"
      
      - name: Create build directory
        run: mkdir -p build
      
      - name: Copy game files
        run: |
          # Copy main files
          cp index.html build/
          
          # Copy CSS
          mkdir -p build/css
          cp -r css/* build/css/
          
          # Copy JavaScript
          mkdir -p build/js
          cp -r js/* build/js/
          
          # Copy assets if exists
          if [ -d "assets" ]; then
            mkdir -p build/assets
            cp -r assets/* build/assets/
          fi
          
          # Create version file
          echo "${{ steps.version.outputs.version }}" > build/version.txt
          
          # Create README
          cat > build/README.txt << 'EOF'
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘                      Ğ“ĞĞ™Ğ”ĞĞ‘Ğ›ĞĞšĞ¡                            â•‘
          â•‘              Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ğ² Ğ Ğ¾ÑÑĞ¸Ğ¸                      â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘                                                            â•‘
          â•‘  ĞšĞ°Ğº Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ:                                            â•‘
          â•‘  1. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ index.html Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ                         â•‘
          â•‘     (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Chrome Ğ¸Ğ»Ğ¸ Firefox)                     â•‘
          â•‘                                                            â•‘
          â•‘  Ğ’Ğ°Ğ¶Ğ½Ğ¾: Ğ”Ğ»Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¸Ğ³Ñ€Ñ‹ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾              â•‘
          â•‘  Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€:                           â•‘
          â•‘                                                            â•‘
          â•‘  Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 1 (Python):                                        â•‘
          â•‘    python -m http.server 8000                              â•‘
          â•‘    ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ http://localhost:8000                          â•‘
          â•‘                                                            â•‘
          â•‘  Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 2 (Node.js):                                       â•‘
          â•‘    npx serve .                                             â•‘
          â•‘    ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ°Ğ´Ñ€ĞµÑ                                â•‘
          â•‘                                                            â•‘
          â•‘  Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 3 (VS Code):                                       â•‘
          â•‘    Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ "Live Server"                     â•‘
          â•‘    ĞŸĞšĞœ Ğ½Ğ° index.html -> "Open with Live Server"            â•‘
          â•‘                                                            â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘                       Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ                           â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘  WASD          - Ğ”Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ                                  â•‘
          â•‘  ĞœÑ‹ÑˆÑŒ          - ĞšĞ°Ğ¼ĞµÑ€Ğ°                                    â•‘
          â•‘  ĞŸĞ ĞĞ‘Ğ•Ğ›        - ĞŸÑ€Ñ‹Ğ¶Ğ¾Ğº                                    â•‘
          â•‘  SHIFT         - Ğ‘ĞµĞ³                                       â•‘
          â•‘  E             - Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ                            â•‘
          â•‘  I             - Ğ˜Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ                                 â•‘
          â•‘  F             - Ğ’Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸Ğ· Ğ¼Ğ°ÑˆĞ¸Ğ½Ñ‹                           â•‘
          â•‘  ESC           - ĞŸĞ°ÑƒĞ·Ğ°                                     â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘                       ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸                          â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘  â€¢ ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€ Ñ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¾Ğ¼ Ğ² Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑÑ‚Ğ¸Ğ»Ğµ                  â•‘
          â•‘  â€¢ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»Ğ¸ Ğ›ĞĞ”Ğ (2109, 2107, Ğ“Ñ€Ğ°Ğ½Ñ‚Ğ°, Ğ’ĞµÑÑ‚Ğ°, ĞĞ¸Ğ²Ğ°)       â•‘
          â•‘  â€¢ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ½Ñ Ğ¸ Ğ½Ğ¾Ñ‡Ğ¸ Ñ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ¾Ğ¹               â•‘
          â•‘  â€¢ ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ñ‹: ĞŸÑÑ‚Ñ‘Ñ€Ğ¾Ñ‡ĞºĞ°, ĞœĞ°Ğ³Ğ½Ğ¸Ñ‚                             â•‘
          â•‘  â€¢ Ğ‘Ğ°Ğ½ĞºĞ¸: Ğ¡Ğ±ĞµÑ€Ğ±Ğ°Ğ½Ğº, Ğ’Ğ¢Ğ‘                                    â•‘
          â•‘  â€¢ Ğ’Ğ¾ĞµĞ½ĞºĞ¾Ğ¼Ğ°Ñ‚ Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ°Ğ¼Ğ¸ Ğ¡Ğ’Ğ                             â•‘
          â•‘  â€¢ Ğ¦ĞµĞ½Ñ‚Ñ€ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ¶Ğ´Ğ°ĞµĞ¼Ğ¾ÑÑ‚Ğ¸                             â•‘
          â•‘  â€¢ NPC Ñ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°Ğ¼Ğ¸                                         â•‘
          â•‘  â€¢ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ°, Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ Ğ¸ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸                      â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          EOF
      
      - name: Create ZIP archive
        run: |
          cd build
          zip -r ../goydablox-${{ steps.version.outputs.version }}.zip .
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: goydablox-${{ steps.version.outputs.version }}
          path: goydablox-${{ steps.version.outputs.version }}.zip
      
      - name: Create Release
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v1
        with:
          files: goydablox-${{ steps.version.outputs.version }}.zip
          name: Ğ“ĞĞ™Ğ”ĞĞ‘Ğ›ĞĞšĞ¡ ${{ steps.version.outputs.version }}
          body: |
            ## ğŸ® Ğ“ĞĞ™Ğ”ĞĞ‘Ğ›ĞĞšĞ¡ - Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ğ² Ğ Ğ¾ÑÑĞ¸Ğ¸
            
            ### Ğ§Ñ‚Ğ¾ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ² ÑÑ‚Ğ¾Ğ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸:
            - ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ ĞºĞ¾Ğ´Ğ°
            - ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°
            - Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
            - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»Ğ¸ Ğ›ĞĞ”Ğ (5 Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹)
            - Ğ¦ĞµĞ½Ñ‚Ñ€ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ¶Ğ´Ğ°ĞµĞ¼Ğ¾ÑÑ‚Ğ¸
            - Ğ ĞµĞºĞ»Ğ°Ğ¼Ğ½Ñ‹Ğµ Ğ±Ğ°Ğ½Ğ½ĞµÑ€Ñ‹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ° Ğ¡Ğ’Ğ
            - Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°
            - Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ½Ñ/Ğ½Ğ¾Ñ‡Ğ¸
            - Ğ˜ Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğµ Ğ´Ñ€ÑƒĞ³Ğ¾Ğµ!
            
            ### ĞšĞ°Ğº Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ:
            1. Ğ¡ĞºĞ°Ñ‡Ğ°Ğ¹Ñ‚Ğµ ZIP Ğ°Ñ€Ñ…Ğ¸Ğ²
            2. Ğ Ğ°ÑĞ¿Ğ°ĞºÑƒĞ¹Ñ‚Ğµ Ğ² Ğ»ÑĞ±ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ
            3. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€ (ÑĞ¼. README.txt)
            4. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ index.html Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ
            
            ### Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:
            - Ğ¡Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€ (Chrome, Firefox, Edge)
            - WebGL Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Create Dev Release
        if: github.ref == 'refs/heads/main' && !startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v1
        with:
          files: goydablox-${{ steps.version.outputs.version }}.zip
          name: Dev Build ${{ steps.version.outputs.version }}
          tag_name: dev-latest
          body: |
            ## ğŸ”§ Development Build
            
            ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ±Ğ¾Ñ€ĞºĞ° Ğ¸Ğ· Ğ²ĞµÑ‚ĞºĞ¸ main.
            
            **Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ:** Ğ­Ñ‚Ğ¾ dev-Ğ²ĞµÑ€ÑĞ¸Ñ, Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸!
            
            Ğ”Ğ°Ñ‚Ğ° ÑĞ±Ğ¾Ñ€ĞºĞ¸: ${{ github.event.head_commit.timestamp }}
            ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚: ${{ github.sha }}
          draft: false
          prerelease: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}